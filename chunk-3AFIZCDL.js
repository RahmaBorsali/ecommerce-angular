import{a as L,b as $,c as w,d as J,e as M,h as U,j as P,l as G,q as j,s as q}from"./chunk-PI5CFJYO.js";import{a as K}from"./chunk-44UXRYPE.js";import{$ as g,Ma as k,Qa as _,V as E,Xa as f,Xb as T,Ya as n,Yb as O,Za as i,_ as x,_a as p,a as v,b as S,bb as A,bc as B,cb as b,d as H,db as u,e as C,ga as N,gc as F,nb as o,ob as D,pb as V,xa as a}from"./chunk-R6KUZMSD.js";var I=H(K());function Q(s,t){if(s&1){let e=A();n(0,"button",8),b("click",function(){x(e);let l=u();return g(l.startAdd())}),o(1," Nouvelle adresse "),i()}}function W(s,t){if(s&1){let e=A();n(0,"form",9)(1,"div",10)(2,"div")(3,"label",11),o(4,"Nom complet"),i(),p(5,"input",12),i(),n(6,"div")(7,"label",11),o(8,"Adresse"),i(),p(9,"input",13),i(),n(10,"div")(11,"label",11),o(12,"Ville"),i(),p(13,"input",14),i(),n(14,"div")(15,"label",11),o(16,"Pays"),i(),p(17,"input",15),i(),n(18,"label",16),p(19,"input",17),o(20," D\xE9finir comme adresse par d\xE9faut "),i()(),n(21,"div",18)(22,"button",19),b("click",function(){x(e);let l=u();return g(l.save())}),o(23," Enregistrer "),i(),n(24,"button",20),b("click",function(){x(e);let l=u();return g(l.cancel())}),o(25,"Annuler"),i()()()}if(s&2){let e=u();f("formGroup",e.form)}}function X(s,t){if(s&1){let e=A();n(0,"div",21)(1,"div",22),o(2,"\u{1F3E0}"),i(),n(3,"p",23),o(4,"Aucune adresse enregistr\xE9e."),i(),n(5,"button",24),b("click",function(){x(e);let l=u();return g(l.startAdd())}),o(6," Ajouter une adresse "),i()()}}function Y(s,t){s&1&&(n(0,"span",37),o(1,"Par d\xE9faut"),i())}function Z(s,t){if(s&1&&(n(0,"span"),o(1),i()),s&2){let e=u().$implicit;a(),V(", ",e.city)}}function ee(s,t){if(s&1&&(n(0,"span"),o(1),i()),s&2){let e=u().$implicit;a(),D(e.country)}}function te(s,t){if(s&1){let e=A();n(0,"button",38),b("click",function(){x(e);let l=u().$implicit,d=u();return g(d.setDefault(l))}),o(1," Par d\xE9faut "),i()}}function ie(s,t){if(s&1){let e=A();n(0,"div",25)(1,"div",26)(2,"div")(3,"div",27),o(4),i()(),_(5,Y,2,0,"span",28),i(),n(6,"div",29),o(7),_(8,Z,2,1,"span",30),p(9,"br"),_(10,ee,2,1,"span",30),i(),n(11,"div",31)(12,"button",32),b("click",function(){let l=x(e).$implicit,d=u();return g(d.startEdit(l))}),p(13,"i",33),n(14,"span"),o(15,"Modifier"),i()(),n(16,"button",34),b("click",function(){let l=x(e).$implicit,d=u();return g(d.remove(l))}),p(17,"i",35),n(18,"span"),o(19,"Supprimer"),i()(),_(20,te,2,0,"button",36),i()()}if(s&2){let e=t.$implicit;a(4),D(e.fullName),a(),f("ngIf",e.isDefault),a(2),V(" ",e.line1),a(),f("ngIf",e.city),a(2),f("ngIf",e.country),a(10),f("ngIf",!e.isDefault)}}var h="app.addresses",R=class s{fb=E(j);auth=E(F);addresses=N([]);editId=N(null);form=this.fb.group({fullName:["",[w.required,w.minLength(2)]],line1:["",[w.required,w.minLength(4)]],city:[""],country:["Tunisie"],isDefault:[""]});ngOnInit(){this.refreshList()}refreshList(){let t=this.auth.currentUser();if(!t){this.addresses.set([]);return}let e=JSON.parse(localStorage.getItem(h)||"[]");this.addresses.set(e.filter(r=>r.userId===t.id))}startAdd(){let t=this.auth.currentUser();this.editId.set("new"),this.form.reset({fullName:t?`${t.firstName} ${t.lastName??""}`.trim():"",line1:"",city:"",country:"Tunisie",isDefault:!1})}startEdit(t){this.editId.set(t.id),this.form.reset({fullName:t.fullName,line1:t.line1,city:t.city??"",country:t.country??"Tunisie",isDefault:!!t.isDefault})}cancel(){this.editId.set(null)}save(){return C(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched();return}let t=this.auth.currentUser();if(!t||!(yield I.default.fire({title:"Confirmer la sauvegarde",text:"Voulez-vous enregistrer cette adresse ?",icon:"question",showCancelButton:!0,confirmButtonColor:"#2563eb",cancelButtonColor:"#9ca3af",confirmButtonText:"Oui, enregistrer",cancelButtonText:"Annuler"})).isConfirmed)return;let r=this.form.getRawValue(),l={fullName:(r.fullName??"").trim(),line1:(r.line1??"").trim(),city:(r.city??"").trim()||void 0,country:(r.country??"").trim()||void 0,isDefault:!!r.isDefault},d=JSON.parse(localStorage.getItem(h)||"[]"),c=d.filter(m=>m.userId===t.id);if(this.editId()==="new"){let m=v({id:crypto.randomUUID(),userId:t.id},l);m.isDefault&&(c=c.map(y=>S(v({},y),{isDefault:!1}))),c.unshift(m)}else{let m=c.findIndex(y=>y.id===this.editId());m>=0&&(l.isDefault&&(c=c.map(y=>S(v({},y),{isDefault:y.id===this.editId()}))),c[m]=v(v({},c[m]),l))}let z=d.filter(m=>m.userId!==t.id);localStorage.setItem(h,JSON.stringify([...z,...c])),yield I.default.fire({icon:"success",title:"Enregistr\xE9",text:"Votre adresse a \xE9t\xE9 sauvegard\xE9e.",timer:1400,showConfirmButton:!1}),this.refreshList(),this.cancel()})}remove(t){return C(this,null,function*(){if(!(yield I.default.fire({title:"Supprimer cette adresse ?",text:"Cette action est irr\xE9versible.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#9ca3af",confirmButtonText:"Oui, supprimer",cancelButtonText:"Annuler"})).isConfirmed)return;let r=this.auth.currentUser();if(!r)return;let d=JSON.parse(localStorage.getItem(h)||"[]").filter(c=>!(c.userId===r.id&&c.id===t.id));localStorage.setItem(h,JSON.stringify(d)),this.refreshList(),I.default.fire({icon:"success",title:"Supprim\xE9e",text:"Adresse supprim\xE9e avec succ\xE8s.",timer:1200,showConfirmButton:!1})})}setDefault(t){let e=this.auth.currentUser();if(!e)return;let l=JSON.parse(localStorage.getItem(h)||"[]").map(d=>d.userId===e.id?S(v({},d),{isDefault:d.id===t.id}):d);localStorage.setItem(h,JSON.stringify(l)),this.refreshList()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=k({type:s,selectors:[["app-account-addresses"]],decls:9,vars:4,consts:[[1,"p-6","lg:p-8"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-xl","font-semibold"],["class","px-4 py-2 rounded-lg bg-blue-600 text-white hover:opacity-90",3,"click",4,"ngIf"],["class","rounded-2xl border bg-white p-4 lg:p-6 mb-6",3,"formGroup",4,"ngIf"],["class","text-center p-10 rounded-xl border bg-white",4,"ngIf"],[1,"grid","sm:grid-cols-2","gap-4"],["class","rounded-2xl border bg-white p-4 lg:p-6",4,"ngFor","ngForOf"],[1,"px-4","py-2","rounded-lg","bg-blue-600","text-white","hover:opacity-90",3,"click"],[1,"rounded-2xl","border","bg-white","p-4","lg:p-6","mb-6",3,"formGroup"],[1,"grid","gap-4"],[1,"text-sm"],["formControlName","fullName",1,"w-full","border","rounded","px-3","py-2"],["formControlName","line1",1,"w-full","border","rounded","px-3","py-2"],["formControlName","city",1,"w-full","border","rounded","px-3","py-2"],["formControlName","country",1,"w-full","border","rounded","px-3","py-2"],[1,"flex","items-center","gap-2"],["type","checkbox","formControlName","isDefault",1,"h-4","w-4"],[1,"mt-4","flex","gap-2"],["type","button",1,"px-4","py-2","rounded-lg","bg-blue-600","text-white",3,"click"],["type","button",1,"px-4","py-2","rounded-lg","border",3,"click"],[1,"text-center","p-10","rounded-xl","border","bg-white"],[1,"text-5xl","mb-2"],[1,"font-medium"],[1,"mt-3","px-4","py-2","rounded-lg","bg-blue-600","text-white",3,"click"],[1,"rounded-2xl","border","bg-white","p-4","lg:p-6"],[1,"flex","items-start","justify-between","gap-3"],[1,"font-semibold"],["class","text-xs rounded-full px-2 py-1 bg-emerald-100 text-emerald-800",4,"ngIf"],[1,"mt-2","text-gray-700"],[4,"ngIf"],[1,"mt-4","flex","flex-wrap","gap-2"],[1,"flex","items-center","gap-2","px-3","py-1.5","rounded-lg","border","border-blue-600","text-blue-600","bg-blue-50","hover:bg-blue-600","hover:text-white","transition-all","duration-200",3,"click"],[1,"icon-edit","text-sm"],[1,"flex","items-center","gap-2","px-3","py-1.5","rounded-lg","border","border-rose-500","text-rose-600","bg-rose-50","hover:bg-rose-600","hover:text-white","transition-all","duration-200",3,"click"],[1,"icon-trash","text-sm"],["class","px-3 py-1.5 rounded-lg bg-blue-600 text-white",3,"click",4,"ngIf"],[1,"text-xs","rounded-full","px-2","py-1","bg-emerald-100","text-emerald-800"],[1,"px-3","py-1.5","rounded-lg","bg-blue-600","text-white",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"Adresses"),i(),_(4,Q,2,0,"button",3),i(),_(5,W,26,1,"form",4)(6,X,7,0,"div",5),n(7,"div",6),_(8,ie,21,6,"div",7),i()()),e&2&&(a(4),f("ngIf",!r.editId()),a(),f("ngIf",r.editId()),a(),f("ngIf",r.addresses().length===0),a(2),f("ngForOf",r.addresses()))},dependencies:[B,T,O,q,U,$,L,J,M,P,G],encapsulation:2})};export{R as AccountAddresses};
