<app-header></app-header>
<section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">

  <!-- Breadcrumb + titre + actions -->
  <div class="mb-6 flex items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold mt-2">Votre panier</h1>
    </div>
    <button
      *ngIf="cart.length"
      (click)="clearAll()"
      class="text-sm text-red-600 hover:text-red-700"
    >
      Vider le panier
    </button>
  </div>

  <!-- État vide -->
  <div *ngIf="cart.length === 0" class="text-center py-16 bg-white rounded-xl shadow-sm">
    <div class="icon-shopping-cart text-6xl text-gray-300 mb-4"></div>
    <h2 class="text-2xl font-semibold mb-2">Votre panier est vide</h2>
    <p class="text-gray-500 mb-6">Découvrez nos dernières nouveautés et promos.</p>
    <a routerLink="/home" class="inline-flex items-center rounded-lg bg-blue-600 px-5 py-3 font-semibold text-white hover:bg-blue-500">
      Continuer vos achats
    </a>
  </div>

  <!-- Contenu panier -->
  <div *ngIf="cart.length" class="grid grid-cols-1 lg:grid-cols-12 gap-8">

    <!-- Liste d'articles -->
    <div class="lg:col-span-8 space-y-4">
      <div
        *ngFor="let item of cart; trackBy: trackById"
        class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 md:p-5"
      >
        <div class="grid grid-cols-[80px_1fr_auto_auto] md:grid-cols-[96px_1fr_auto_auto] items-center gap-4 md:gap-6">
          <!-- Image -->
          <img
            [src]="item.image"
            [alt]="item.name"
            class="w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg border"
          />

          <!-- Infos -->
          <div class="min-w-0">
            <h3 class="font-semibold truncate">{{ item.name }}</h3>
            <p class="text-sm text-gray-500 mt-1">Réf. #{{ item.id }}</p>
            <div class="mt-2 text-blue-600 font-bold md:hidden">
              {{ (item.price * item.quantity) | number:'1.2-2' }} DT
            </div>
          </div>

          <!-- Quantité -->
          <div class="flex items-center justify-end gap-2">
            <button
              (click)="dec(item)"
              [disabled]="item.quantity <= 1"
              class="w-8 h-8 rounded-lg border hover:bg-gray-50 disabled:opacity-40"
              aria-label="Diminuer"
            >−</button>
            <span class="w-10 text-center font-medium">{{ item.quantity }}</span>
            <button
              (click)="inc(item)"
              class="w-8 h-8 rounded-lg border hover:bg-gray-50"
              aria-label="Augmenter"
            >+</button>
          </div>

          <!-- Prix total ligne (desktop) -->
          <div class="hidden md:block text-right">
            <div class="text-lg font-semibold">
              {{ (item.price * item.quantity) | number:'1.2-2' }} DT
            </div>
            <div class="text-sm text-gray-400">
              {{ item.price | number:'1.2-2' }} DT / u
            </div>
          </div>
        </div>

        <!-- Actions ligne -->
        <div class="mt-3 flex justify-between text-sm">
          <a routerLink="/products/{{item.id}}" class="text-gray-500 hover:text-gray-700">Voir le produit</a>
          <button (click)="remove(item)" class="text-red-600 hover:text-red-700 inline-flex items-center gap-1">
            <i class="icon-trash-2"></i> Supprimer
          </button>
        </div>
      </div>

      <!-- Lien retour -->
      <div class="flex justify-start">
        <a routerLink="/home" class="inline-flex items-center text-sm text-gray-600 hover:text-blue-600">
          ← Continuer vos achats
        </a>
      </div>
    </div>

    <!-- Récapitulatif -->
    <aside class="lg:col-span-4">
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-24">
        <h2 class="text-xl font-bold mb-4">Récapitulatif</h2>

        <!-- Barre “Livraison offerte” -->
        <div class="mb-4">
          <div class="flex justify-between text-sm text-gray-600 mb-1">
            <span>Livraison offerte dès {{ FREE_SHIPPING_THRESHOLD | number:'1.0-0' }} DT</span>
            <span *ngIf="subtotal < FREE_SHIPPING_THRESHOLD">
              Manque {{ (FREE_SHIPPING_THRESHOLD - subtotal) | number:'1.2-2' }} DT
            </span>
            <span *ngIf="subtotal >= FREE_SHIPPING_THRESHOLD" class="text-green-600 font-medium">Obtenue ✓</span>
          </div>
          <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
            <div
              class="h-full bg-green-500"
              [style.width.%]="Math.min(100, (subtotal / FREE_SHIPPING_THRESHOLD) * 100)"
            ></div>
          </div>
        </div>

        <!-- Coupon -->
        <form (ngSubmit)="applyCoupon()" class="mb-4 flex gap-2">
          <input
            [(ngModel)]="couponCode"
            name="coupon"
            type="text"
            placeholder="Code promo (ex: SALE10, FREESHIP)"
            class="flex-1 rounded-lg border px-3 py-2 text-sm"
          />
          <button
            class="rounded-lg bg-gray-900 text-white px-4 py-2 text-sm hover:bg-gray-800"
          >
            Appliquer
          </button>
        </form>

        <!-- Détails -->
        <div class="space-y-3 mb-4 text-sm">
          <div class="flex justify-between">
            <span>Sous-total</span>
            <span>{{ subtotal | number:'1.2-2' }} DT</span>
          </div>
          <div class="flex justify-between" *ngIf="discount > 0">
            <span>Remise</span>
            <span class="text-green-600">-{{ discount | number:'1.2-2' }} DT</span>
          </div>
          <div class="flex justify-between">
            <span>Livraison</span>
            <span>{{ shipping | number:'1.2-2' }} DT</span>
          </div>
          <div class="border-t pt-3 flex justify-between text-base font-bold">
            <span>Total</span>
            <span class="text-blue-600">{{ total | number:'1.2-2' }} DT</span>
          </div>
        </div>

        <a
          routerLink="/checkout"
          class="block w-full text-center rounded-lg bg-blue-600 text-white font-semibold py-3 hover:bg-blue-500"
        >
          Procéder au paiement
        </a>
      </div>
    </aside>
  </div>
</section>
<app-footer></app-footer>
