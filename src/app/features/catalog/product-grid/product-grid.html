<div class="flex flex-col lg:flex-row gap-8">
  <!-- Sidebar filtres -->
  <aside class="lg:w-64 space-y-6">
    <div class="bg-white rounded-lg shadow-md p-4">
      <h3 class="font-semibold mb-3">Catégorie</h3>
      <select
        [(ngModel)]="selectedCategory"
        (change)="applyAll()"
        class="w-full px-3 py-2 border border-gray-200 rounded-lg"
      >
        <option value="">Toutes</option>
        <option *ngFor="let c of categories" [value]="c">
          {{ c }}
        </option>
      </select>
    </div>

    <div class="bg-white rounded-lg shadow-md p-4">
      <h3 class="font-semibold mb-3">Prix max.</h3>
      <input
        type="range"
        min="0"
        [max]="maxPriceCeil"
        [(ngModel)]="priceMax"
        (input)="applyAll()"
        class="w-full"
      />
      <div class="text-sm text-gray-600 mt-2">
        0 – {{ priceMax | number: '1.0-0' }} DT
      </div>
    </div>
  </aside>

  <!-- Liste produits -->
  <div class="flex-1">
    <div
      class="flex flex-col sm:flex-row justify-between gap-3 items-center mb-6"
    >
      <p class="text-gray-600">{{ filtered.length }} produits</p>

      <div class="flex gap-2 w-full sm:w-auto">
        <input
          [(ngModel)]="searchQuery"
          (keyup.enter)="applyAll()"
          class="flex-1 sm:w-64 px-3 py-2 border border-gray-200 rounded-lg"
          placeholder="Rechercher..."
        />
        <select
          [(ngModel)]="sortBy"
          (change)="applyAll()"
          class="px-4 py-2 border border-gray-200 rounded-lg"
        >
          <option value="">Trier par</option>
          <option value="price-asc">Prix ↑</option>
          <option value="price-desc">Prix ↓</option>
        </select>
      </div>
    </div>

    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
    >
      <article
        *ngFor="let p of pageItems"
        class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition"
      >
        <a
          [routerLink]="['/products', p._id]"
          class="block bg-white"
        >
          <img
            [src]="p.images?.[0] || 'assets/placeholder.png'"
            [alt]="p.name"
            class="w-full h-48 object-contain p-3"
          />
        </a>
        <div class="p-4">
          <a [routerLink]="['/products', p._id]">
            <h3
              class="font-semibold text-lg mb-2 hover:text-blue-600"
            >
              {{ p.name }}
            </h3>
          </a>

          <div class="flex items-center justify-between">
            <span class="text-2xl font-bold text-blue-600">
              {{ (p.promoPrice ?? p.price) | number: '1.2-2' }} DT
            </span>
            <button
              (click)="addToCart(p)"
              class="bg-orange-500 text-white p-2 rounded-lg hover:bg-orange-600"
              title="Ajouter au panier"
            >
              <i class="icon-shopping-cart text-lg"></i>
            </button>
          </div>
        </div>
      </article>
    </div>

    <div
      *ngIf="totalPages > 1"
      class="flex justify-center gap-2 mt-8"
    >
      <button
        *ngFor="let n of pages"
        (click)="goPage(n)"
        class="px-4 py-2 rounded"
        [class.bg-blue-600]="currentPage === n"
        [class.text-white]="currentPage === n"
        [class.bg-gray-200]="currentPage !== n"
      >
        {{ n }}
      </button>
    </div>
  </div>
</div>
