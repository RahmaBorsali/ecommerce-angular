<section class="mx-auto md:px-10 py-12">
  <h2 class="text-3xl font-bold mb-10 text-center text-gray-900">
    Produits Vedettes
  </h2>

  <!-- loader / erreur -->
  <div *ngIf="loading" class="text-center text-gray-500 py-8">
    Chargementâ€¦
  </div>

  <div *ngIf="!loading && error" class="text-center text-red-500 py-8">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
    <article
      *ngFor="let p of products"
      class="group overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm hover:shadow-lg transition-transform duration-300"
    >
      <!-- Image produit -->
      <a [routerLink]="['/products', p._id]" class="block overflow-hidden relative">
        <img
          [src]="getImage(p)"
          [alt]="p.name"
          class="h-48 w-full object-cover group-hover:scale-105 transition-transform duration-300"
        />
      </a>

      <!-- Contenu -->
      <div class="p-4 space-y-3">
        <!-- Titre -->
        <h3 class="font-semibold text-sm md:text-base leading-tight">
          <a [routerLink]="['/products', p._id]" class="hover:text-blue-600">
            {{ p.name }}
          </a>
        </h3>

        <!-- â­ Ã‰toiles -->
        <div class="flex items-center gap-1 text-[#f97316] text-lg drop-shadow-sm">
          <ng-container *ngFor="let s of starArray(getRating(p))">
            <span>{{ s ? 'â˜…' : 'â˜†' }}</span>
          </ng-container>
          <span class="text-gray-400 text-xs ml-1">
            {{ getRating(p) | number: '1.1-1' }}
          </span>
        </div>

        <!-- ðŸ’° Prix + ðŸ›’ -->
        <div class="flex items-center justify-between">
          <div class="text-lg font-extrabold text-[#2563eb]">
            {{ (p.promoPrice ?? p.price) | number:'1.2-2' }}&nbsp;DT
          </div>

          <div class="flex items-center gap-2">
            <button
              (click)="addToCart(p)"
              class="flex items-center justify-center rounded-full bg-[#f97316] hover:bg-[#ea580c] text-white w-9 h-9 shadow-sm transition"
              title="Ajouter au panier"
            >
              <i class="icon-shopping-cart text-base"></i>
            </button>

            <a
              [routerLink]="['/products', p._id]"
              class="flex items-center justify-center rounded-full border border-gray-300 text-gray-600 hover:text-blue-600 hover:border-blue-500 w-9 h-9 transition"
              title="Voir le produit"
            >
              <i class="icon-eye text-base"></i>
            </a>
          </div>
        </div>
      </div>
    </article>
  </div>

  <div class="flex justify-center mt-12" *ngIf="products.length">
    <a
      [routerLink]="'/catalog'"
      class="inline-flex items-center gap-2 px-6 py-3
             bg-gradient-to-r from-blue-500 to-blue-700
             text-white font-semibold rounded-full
             shadow-md hover:shadow-xl
             hover:scale-105 hover:gap-3
             transition-all duration-300 ease-out"
    >
      <span>Voir tous les Produits</span>
    </a>
  </div>
</section>
