<app-header></app-header>

<section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
  <!-- En-tÃªte -->
  <header class="mb-6">
    <h1 class="text-2xl md:text-3xl font-bold">Recherche</h1>
    <p class="text-sm text-gray-600">
      <ng-container *ngIf="q; else noQuery">
        RÃ©sultats pour Â« <b>{{ q }}</b> Â»
        â€” {{ products.length }} produit(s), {{ categories.length }} catÃ©gorie(s)
      </ng-container>
      <ng-template #noQuery>
        Tapez un mot-clÃ© pour rechercher dans tout le site.
      </ng-template>
    </p>
  </header>

  <!-- Loader / erreur -->
  <div *ngIf="loading" class="p-10 text-center rounded-xl border bg-white text-gray-500">
    Chargementâ€¦
  </div>

  <div *ngIf="!loading && error" class="p-10 text-center rounded-xl border bg-white text-red-500">
    {{ error }}
  </div>

  <!-- Rien tapÃ© -->
  <div *ngIf="!loading && !error && !q" class="p-10 text-center rounded-xl border bg-white">
    <div class="text-5xl mb-2">ðŸ”Ž</div>
    <p class="font-medium">Recherchez des produits, des catÃ©goriesâ€¦</p>
    <p class="text-gray-500">Exemples : Â« iphone Â», Â« casque Â», Â« gaming Â»â€¦</p>
  </div>

  <ng-container *ngIf="!loading && !error && q">
    <!-- CatÃ©gories correspondantes -->
    <div class="mb-6" *ngIf="categories.length">
      <h2 class="text-lg font-semibold mb-3">CatÃ©gories</h2>
      <div class="flex flex-wrap gap-2">
        <a
          *ngFor="let c of categories"
          [routerLink]="['/catalog']"
          [queryParams]="{ category: c }"
          class="px-3 py-1.5 rounded-full border bg-white hover:bg-blue-50 transition text-sm"
        >
          #{{ c }}
        </a>
      </div>
    </div>

    <!-- Produits -->
    <div
      *ngIf="products.length; else noResults"
      class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"
    >
      <a
        *ngFor="let p of products"
        [routerLink]="['/products', p._id]"
        class="block bg-white rounded-xl border p-4 hover:shadow-md transition"
      >
        <img
          [src]="getImage(p)"
          [alt]="p.name"
          class="w-full h-44 object-cover rounded-lg mb-3"
        />
        <div class="font-semibold line-clamp-2">
          {{ p.name }}
        </div>
        <div class="text-sm text-gray-500 capitalize">
          {{ getCategoryLabel(p) }}
        </div>
        <div class="mt-2 font-bold">
          {{ getDisplayPrice(p) | number:'1.2-2' }}&nbsp;DT
        </div>
      </a>
    </div>

    <ng-template #noResults>
      <div class="p-10 text-center rounded-xl border bg-white">
        <div class="text-5xl mb-2">ðŸ™ˆ</div>
        <p class="font-medium">Aucun rÃ©sultat trouvÃ© pour Â« {{ q }} Â».</p>
        <p class="text-gray-500">
          Astuce : essayez un autre terme ou une catÃ©gorie plus large.
        </p>
      </div>
    </ng-template>
  </ng-container>
</section>

<app-footer></app-footer>
