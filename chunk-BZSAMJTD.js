import{a as j,b as P}from"./chunk-X7VRKKFN.js";import{f as O,h as M,i as F,j as U,k as R}from"./chunk-IW6AFLJC.js";import"./chunk-PI5CFJYO.js";import{Gb as _,Hb as I,Ma as y,Qa as f,V as m,Xa as g,Xb as L,Ya as r,Yb as N,Za as i,_a as l,a as p,b as h,bc as D,cb as x,db as w,eb as C,fb as A,ga as u,gc as W,mb as S,nb as c,ob as v,pb as E,xa as a,xb as k,z as b}from"./chunk-R6KUZMSD.js";var G=[[["","account-actions",""]]],H=["[account-actions]"],q=()=>({exact:!0});function z(o,e){if(o&1&&(r(0,"span",17),c(1),i()),o&2){let t=w().$implicit;a(),E(" ",t.badge," ")}}function B(o,e){if(o&1&&(r(0,"a",12)(1,"div",13)(2,"div",14),l(3,"i"),i(),r(4,"div",15),c(5),i()(),f(6,z,2,1,"span",16),i()),o&2){let t=e.$implicit;g("routerLink",t.to)("routerLinkActiveOptions",k(6,q)),a(3),S(t.icon+" text-lg"),a(2),v(t.label),a(),g("ngIf",t.badge!=null)}}var K="app.wishlist.",T="app.addresses",J="app.orders",Y="app.guestId",$=class o{router=m(F);auth=m(W);currentPath=u(this.router.url);wishCount=u(0);addrCount=u(0);orderCount=u(0);nav=u([{icon:"icon-user",label:"Informations",to:"/account/profile"},{icon:"icon-archive",label:"Commandes",to:"/account/orders",badge:0},{icon:"icon-map-pin",label:"Adresses",to:"/account/addresses",badge:0},{icon:"icon-heart",label:"Favoris",to:"/account/wishlist",badge:0}]);constructor(){this.router.events.pipe(b(e=>e instanceof O)).subscribe(e=>this.currentPath.set(e.urlAfterRedirects)),this.refreshAllCounters(),window.addEventListener("storage",e=>{e.key&&(e.key.startsWith(K)||e.key===T||e.key===J)&&this.refreshAllCounters()}),window.addEventListener("authChanged",()=>this.refreshAllCounters()),window.addEventListener("wishlistCountUpdated",()=>this.refreshWishlist()),window.addEventListener("addressesUpdated",()=>this.refreshAddresses()),window.addEventListener("ordersUpdated",()=>this.refreshOrders()),I(()=>{let e=this.wishCount(),t=this.addrCount(),n=this.orderCount();this.nav.update(d=>d.map(s=>s.to==="/account/wishlist"?h(p({},s),{badge:e}):s.to==="/account/addresses"?h(p({},s),{badge:t}):s.to==="/account/orders"?h(p({},s),{badge:n}):s))})}title=_(()=>{let e=this.currentPath();return e.endsWith("/profile")?"Informations Personnelles":e.endsWith("/orders")?"Historique des Commandes":e.endsWith("/addresses")?"Adresses":e.endsWith("/wishlist")?"Mes Favoris":"Mon Compte"});uid(){let e=this.auth.currentUser();if(e?.id)return String(e.id);let t=sessionStorage.getItem(Y);return t||(t=crypto.randomUUID(),sessionStorage.setItem(Y,t)),`guest-${t}`}wlKey(){return K+this.uid()}refreshWishlist(){try{let e=JSON.parse(localStorage.getItem(this.wlKey())||"[]");this.wishCount.set(Array.isArray(e)?e.length:0)}catch{this.wishCount.set(0)}}refreshAddresses(){try{let e=this.auth.currentUser()?.id??null,t=JSON.parse(localStorage.getItem(T)||"[]"),n=Array.isArray(t)?t.filter(d=>String(d.userId??"")===String(e??"")):[];this.addrCount.set(n.length)}catch{this.addrCount.set(0)}}refreshOrders(){try{let e=this.auth.currentUser()?.id??null,t=JSON.parse(localStorage.getItem(J)||"[]"),n=Array.isArray(t)?t.filter(d=>String(d.userId??"")===String(e??"")):[];this.orderCount.set(n.length)}catch{this.orderCount.set(0)}}refreshAllCounters(){this.refreshWishlist(),this.refreshAddresses(),this.refreshOrders()}logout(){try{localStorage.removeItem("app.session"),window.dispatchEvent(new Event("authChanged"))}finally{this.router.navigateByUrl("/")}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-account-layout"]],ngContentSelectors:H,decls:21,vars:2,consts:[[1,"min-h-[calc(100vh-80px)]","bg-gradient-to-br","from-blue-50","via-white","to-blue-100"],[1,"container","mx-auto","px-4","py-8"],[1,"grid","gap-6","lg:grid-cols-[280px_1fr]"],[1,"space-y-3"],["routerLinkActive","!bg-blue-600 !text-white !shadow-lg","class",`group flex items-center justify-between rounded-2xl bg-white text-gray-800 px-4 py-4 shadow-sm border border-gray-100
                   hover:shadow-md hover:translate-y-[-1px] transition-all`,3,"routerLink","routerLinkActiveOptions",4,"ngFor","ngForOf"],[1,"w-full","flex","items-center","justify-center","gap-3","rounded-2xl","bg-gradient-to-r","from-red-500","to-red-600","text-white","px-5","py-3","font-semibold","shadow-md","hover:from-red-600","hover:to-red-700","hover:shadow-lg","hover:scale-[1.03]","transition-all","duration-300","ease-in-out","focus:outline-none","focus:ring-2","focus:ring-red-400","focus:ring-offset-2",3,"click"],[1,"icon-logout","text-lg","animate-pulse"],[1,"rounded-3xl","bg-white/80","backdrop-blur","border","border-gray-200/60","shadow-xl","overflow-hidden"],[1,"flex","items-center","justify-between","px-6","sm:px-8","py-5","border-b","bg-gradient-to-r","from-white","to-blue-50"],[1,"text-2xl","md:text-3xl","font-bold"],[1,"text-sm","text-gray-500"],[1,"p-6","sm:p-8"],["routerLinkActive","!bg-blue-600 !text-white !shadow-lg",1,"group","flex","items-center","justify-between","rounded-2xl","bg-white","text-gray-800","px-4","py-4","shadow-sm","border","border-gray-100","hover:shadow-md","hover:translate-y-[-1px]","transition-all",3,"routerLink","routerLinkActiveOptions"],[1,"flex","items-center","gap-3"],[1,"h-10","w-10","rounded-xl","bg-blue-50","text-blue-600","grid","place-items-center","group-[.router-link-active]:bg-white/20","group-[.router-link-active]:text-white"],[1,"font-medium"],["class",`text-xs font-semibold px-2.5 py-1 rounded-full bg-gray-100 text-gray-700
                     group-[.router-link-active]:bg-white/20 group-[.router-link-active]:text-white`,4,"ngIf"],[1,"text-xs","font-semibold","px-2.5","py-1","rounded-full","bg-gray-100","text-gray-700","group-[.router-link-active]:bg-white/20","group-[.router-link-active]:text-white"]],template:function(t,n){t&1&&(C(G),l(0,"app-header"),r(1,"section",0)(2,"div",1)(3,"div",2)(4,"aside",3),f(5,B,7,7,"a",4),r(6,"button",5),x("click",function(){return n.logout()}),l(7,"i",6),r(8,"span"),c(9,"D\xE9connexion"),i()()(),r(10,"main",7)(11,"div",8)(12,"div")(13,"h1",9),c(14),i(),r(15,"p",10),c(16,"G\xE9rez votre espace personnel"),i()(),A(17),i(),r(18,"div",11),l(19,"router-outlet"),i()()()()(),l(20,"app-footer")),t&2&&(a(5),g("ngForOf",n.nav()),a(9),v(n.title()))},dependencies:[D,L,N,U,R,M,j,P],encapsulation:2})};export{$ as AccountLayout};
