import{j as P}from"./chunk-IW6AFLJC.js";import{b as V,c as u,d as L,e as B,h as k,j as D,l as F,q as M,s as O}from"./chunk-PI5CFJYO.js";import{a as j}from"./chunk-44UXRYPE.js";import{$ as x,Ma as S,Qa as v,V as g,Xa as d,Ya as i,Yb as I,Za as t,_ as b,_a as s,a as p,bb as N,bc as A,cb as h,d as G,db as f,e as E,ga as C,gc as T,nb as n,pb as y,qb as U,ua as _,xa as m}from"./chunk-R6KUZMSD.js";var w=G(j());function z(a,r){a&1&&(i(0,"div",2),n(1," Aucun utilisateur connect\xE9. "),i(2,"a",3),n(3,"Connectez-vous"),t(),n(4," pour acc\xE9der \xE0 votre espace personnel. "),t())}function H(a,r){if(a&1&&(i(0,"span",30),n(1),t()),a&2){let e=f(2);m(),y(" ",e.message," ")}}function J(a,r){if(a&1){let e=N();i(0,"div",4)(1,"div",5)(2,"div",6),s(3,"img",7),i(4,"div",8),s(5,"i",9),t()(),i(6,"div",10)(7,"h2",11),n(8),t()(),i(9,"div",12)(10,"label",13),n(11,"Changer l\u2019avatar"),t(),i(12,"input",14),h("change",function(l){b(e);let c=f();return x(c.onAvatarChange(l))}),t()()(),i(13,"form",15),h("ngSubmit",function(){b(e);let l=f();return x(l.save())}),i(14,"div",16)(15,"div")(16,"label",17),n(17,"Pr\xE9nom"),t(),s(18,"input",18),t(),i(19,"div")(20,"label",17),n(21,"Nom"),t(),s(22,"input",19),t(),i(23,"div",20)(24,"label",17),n(25,"Email"),t(),s(26,"input",21),i(27,"small",22),n(28,"L\u2019email est en lecture seule."),t()(),i(29,"div")(30,"label",17),n(31,"T\xE9l\xE9phone"),t(),s(32,"input",23),t(),i(33,"div")(34,"label",17),n(35,"Ville"),t(),s(36,"input",24),t(),i(37,"div",20)(38,"label",17),n(39,"Adresse"),t(),s(40,"input",25),t(),i(41,"div",20)(42,"label",17),n(43,"Pays"),t(),s(44,"input",26),t()(),i(45,"div",27)(46,"button",28),n(47),t(),v(48,H,2,1,"span",29),t()()()}if(a&2){let e=f();m(3),d("src",e.form.value.avatarUrl||"https://ui-avatars.com/api/?name="+(e.form.value.firstName||"U")+"+"+(e.form.value.lastName||"S")+"&background=2563eb&color=fff",_),m(5),U(" ",e.form.value.firstName||"Utilisateur"," ",e.form.value.lastName||""," "),m(5),d("formGroup",e.form),m(34),y(" ",e.saving?"Enregistrement\u2026":" Enregistrer"," "),m(),d("ngIf",e.message)}}var R=class a{fb=g(M);auth=g(T);user=C(null);saving=!1;message="";form=this.fb.group({firstName:["",[u.required,u.minLength(2)]],lastName:["",[u.required,u.minLength(2)]],email:[{value:"",disabled:!0},[u.required,u.email]],phone:[""],address:["",[u.required,u.minLength(5)]],city:[""],country:[""],avatarUrl:[""]});ngOnInit(){let r=this.auth.currentUser();this.user.set(r),r&&this.form.patchValue({firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone||"",address:r.address||"",city:r.city||"",country:r.country||"",avatarUrl:r.avatarUrl||""})}onAvatarChange(r){let e=r.target;if(!e.files||!e.files[0])return;let o=e.files[0],l=new FileReader;l.onload=()=>this.form.patchValue({avatarUrl:l.result}),l.readAsDataURL(o)}save(){return E(this,null,function*(){if(!this.user())return;if(this.form.invalid){this.form.markAllAsTouched();return}if(!(yield w.default.fire({title:"Confirmer la modification",text:"Souhaitez-vous enregistrer ces changements sur votre profil ?",icon:"question",showCancelButton:!0,confirmButtonColor:"#2563eb",cancelButtonColor:"#9ca3af",confirmButtonText:"Oui, enregistrer",cancelButtonText:"Annuler"})).isConfirmed)return;this.saving=!0;let e=this.form.getRawValue(),o=this.auth.updateCurrent?this.auth.updateCurrent(e):this._manualUpdateCurrent(e);this.user.set(o),this.saving=!1,yield w.default.fire({icon:"success",title:"Profil mis \xE0 jour",text:"Vos informations personnelles ont \xE9t\xE9 enregistr\xE9es avec succ\xE8s.",showConfirmButton:!1,timer:2e3})})}_manualUpdateCurrent(r){let e=this.auth.currentUser();if(!e)return null;let o=(()=>{try{return JSON.parse(localStorage.getItem("app.users")||"[]")}catch{return[]}})(),l=p(p({},e),r),c=o.findIndex(q=>q.id===e.id);return c>=0?o[c]=l:o.push(l),localStorage.setItem("app.users",JSON.stringify(o)),l}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=S({type:a,selectors:[["app-profile"]],decls:2,vars:2,consts:[["class","rounded-lg border border-amber-200 bg-amber-50 p-4 text-amber-800 mb-6",4,"ngIf"],["class","grid gap-10 md:grid-cols-[320px_1fr] items-start",4,"ngIf"],[1,"rounded-lg","border","border-amber-200","bg-amber-50","p-4","text-amber-800","mb-6"],["routerLink","/auth/signin",1,"underline","font-medium"],[1,"grid","gap-10","md:grid-cols-[320px_1fr]","items-start"],[1,"bg-white","rounded-2xl","shadow-lg","p-6","flex","flex-col","items-center","gap-6","border","border-gray-100","hover:shadow-xl","transition-all"],[1,"relative"],["alt","Avatar",1,"h-32","w-32","rounded-full","object-cover","border-4","border-white","shadow-md","ring-4","ring-blue-100",3,"src"],["title","Changer l\u2019avatar",1,"absolute","bottom-1","right-1","bg-blue-600","hover:bg-blue-700","text-white","p-2","rounded-full","shadow","cursor-pointer","transition"],[1,"icon-edit","text-sm"],[1,"w-full","text-center"],[1,"text-lg","font-semibold"],[1,"w-full","mt-4"],[1,"block","text-sm","font-medium","mb-1"],["type","file","accept","image/*",1,"block","w-full","text-sm","border","border-gray-200","rounded-lg","p-2","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-blue-50","file:text-blue-700","hover:file:bg-blue-100",3,"change"],[1,"bg-white","rounded-2xl","border","border-gray-100","shadow-lg","p-8","hover:shadow-xl","transition-all",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","mb-1","text-gray-700"],["formControlName","firstName","placeholder","ex: Ali",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","focus:ring-2","focus:ring-blue-500","focus:outline-none"],["formControlName","lastName","placeholder","ex: Ben Salah",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","focus:ring-2","focus:ring-blue-500","focus:outline-none"],[1,"md:col-span-2"],["formControlName","email","placeholder","email@exemple.com",1,"w-full","rounded-xl","border","border-gray-300","bg-gray-50","px-4","py-2","text-gray-600","cursor-not-allowed"],[1,"text-gray-500"],["formControlName","phone","placeholder","+216 ...",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","focus:ring-2","focus:ring-blue-500","focus:outline-none"],["formControlName","city","placeholder","Tunis",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","focus:ring-2","focus:ring-blue-500","focus:outline-none"],["formControlName","address","placeholder","Rue, num\xE9ro, compl\xE9ment",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","focus:ring-2","focus:ring-blue-500","focus:outline-none"],["formControlName","country","placeholder","Tunisie",1,"w-full","rounded-xl","border","border-gray-300","px-4","py-2","focus:ring-2","focus:ring-blue-500","focus:outline-none"],[1,"mt-8","flex","flex-wrap","items-center","gap-4"],["type","submit",1,"inline-flex","items-center","rounded-xl","bg-blue-600","px-6","py-2.5","text-white","font-medium","hover:bg-blue-700","transition-all"],["class","text-sm text-green-700 bg-green-50 px-3 py-1 rounded-lg",4,"ngIf"],[1,"text-sm","text-green-700","bg-green-50","px-3","py-1","rounded-lg"]],template:function(e,o){e&1&&v(0,z,5,0,"div",0)(1,J,49,6,"div",1),e&2&&(d("ngIf",!o.user()),m(),d("ngIf",o.user()))},dependencies:[A,I,O,k,V,L,B,D,F,P],encapsulation:2})};export{R as Profile};
